"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3949],{3949:(Y,V,s)=>{s.r(V),s.d(V,{MapIframeVietbandoPageModule:()=>U});var b=s(177),S=s(9417),h=s(8974),L=s(2175),u=s(467),k=s(2385),x=s(4103),O=s(4397),I=s(7392),A=s(7762),f=s(5312),P=s(3801),_=s(6841),R=s(4470),y=s(1312),v=s(8650),T=s(3588),D=s(8833),e=s(4438),G=s(4842);function E(a,d){if(1&a&&(e.j41(0,"div",17)(1,"span"),e.EFF(2,"\xa0"),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&a){const c=e.XpG();e.R7$(4),e.JRh(c.currentAddress)}}function w(a,d){1&a&&e.eu8(0)}function j(a,d){if(1&a){const c=e.RV6();e.qex(0),e.j41(1,"ion-button",23),e.bIt("click",function(t){e.eBV(c);const i=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.clearFilter(t,i))}),e.j41(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-icon",24),e.k0s(),e.bVm()}if(2&a){const c=e.XpG().$implicit;e.R7$(3),e.JRh(e.bMT(4,1,c.text))}}function X(a,d){if(1&a){const c=e.RV6();e.qex(0),e.j41(1,"ion-button",23),e.bIt("click",function(t){e.eBV(c);const i=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.clearFilter(t,i))}),e.j41(2,"ion-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"ion-icon",24),e.k0s(),e.bVm()}if(2&a){const c=e.XpG().$implicit;e.R7$(3),e.JRh(e.bMT(4,1,c.text))}}function N(a,d){if(1&a&&(e.qex(0)(1,20),e.DNE(2,w,1,0,"ng-container",21)(3,j,6,3,"ng-container",21)(4,X,6,3,"ng-container",22),e.bVm()()),2&a){const c=d.$implicit;e.R7$(),e.Y8G("ngSwitch",c.type),e.R7$(),e.Y8G("ngSwitchCase","Nearby"),e.R7$(),e.Y8G("ngSwitchCase","Search")}}function B(a,d){if(1&a&&(e.qex(0),e.j41(1,"div",18),e.DNE(2,N,5,3,"ng-container",19),e.k0s(),e.bVm()),2&a){const c=e.XpG();e.R7$(2),e.Y8G("ngForOf",c.getFilters())}}const z=[{path:"",component:(()=>{var a;class d{constructor(n,t,i,o,r){this.router=n,this.modalController=t,this.animationController=i,this.toastController=o,this.loadingController=r,this._receiveMessages=[],this.currentPosition=f.c.app_default.geolocation.pos,this.APP_ROUTE=D._,this.paging={sortfield:null,sorttype:null,page:1,limit:10,loading:!1,active:!0},this.filter={},this.ChargingLocationParams={TopLeftLat:10.914656,TopLeftLong:106.44876,RightBottomLat:10.305755,RightBottomLong:107.1056,PageNumber:1,PageSize:100},this.chargingLocations=[],this.timeoutLoadData=-1,this.isWaitLoad=!1,this.loadingController.create({message:""}).then(g=>this.loading=g)}ngOnInit(){(0,P.fA)({callback:n=>{null!=n&&n.currentAddress&&(this.currentAddress=null==n?void 0:n.currentAddress)}}),this.refreshCurrentPosition(void 0,()=>{this.refreshData()})}resetData(){this.chargingLocations.length=0}pushData(n,t){1==this.paging.page&&(this.chargingLocations.length=0),this.chargingLocations=this.chargingLocations.concat(n),t&&t(this.chargingLocations),this.createMarkers()}totalData(){return this.chargingLocations.length}refreshData(n){var t=this;return(0,u.A)(function*(){t.filter={},t.paging.page=1,t.paging.active=!0,t.loadData_Paging(n)})()}loadMore(n){this.paging.page+=1,this.loadData_Paging(n)}searchChange(n){this.filter={},this.filter.search=n.target.value.replace(/[\`\~\!\@\#\$\%\^\&\*\(\)\-\_\=\+\[\{\]\}\\\|\;\:\'\"\,\<\.\>\/\?]+/g," ").replace(/\s+/g," ").trim(),this.paging.page=1,this.paging.active=!0,this.loadData_Paging()}sortChange(n,t){this.paging.sortfield=n||null,this.paging.sorttype=t||null,this.paging.page=1,this.paging.active=!0,this.loadData_Paging()}filterChange(){this.paging.page=1,this.paging.active=!0,this.loadData_Paging()}loadData_Paging(n){var t=this;return(0,u.A)(function*(){t.paging.loading=!0,t.filter.search?(0,_.tC)({params:{Search:t.filter.search,PageNumber:t.paging.page,PageSize:t.paging.limit},callback:i=>{var o,r;if(t.response=i,null!=i&&i.Succeeded){if(t.pushData(null!==(o=i.Data)&&void 0!==o?o:[]),null!==(r=i.Data)&&void 0!==r&&r.length){let p=i.Data.filter(l=>l.LocLat&&l.LocLong).map(l=>(l.Distance2CL=parseFloat((0,y.GH)(t.currentPosition,{lat:null==l?void 0:l.LocLat,lng:null==l?void 0:l.LocLong}).toFixed(2)),l)).sort((l,F)=>{var C,M;return(null!==(C=l.Distance2CL)&&void 0!==C?C:0)-(null!==(M=F.Distance2CL)&&void 0!==M?M:0)});var g,m;p.length&&t.resetCamera({lat:null!==(g=p[0].LocLat)&&void 0!==g?g:0,lng:null!==(m=p[0].LocLong)&&void 0!==m?m:0})}}else(0,v.cX)(t.toastController,{},i).then(p=>p.present());t.paging.loading=!1,t.paging.active=!(null==i||!i.HasNextPage),n&&n()}}):t.filter.ElectricTypeFilter||t.filter.ConnectorTypeFilter||t.filter.VConnectorStatusFilter||t.filter.VChargeSpeed?(0,_.Zd)({params:{ElectricTypeFilter:t.filter.ElectricTypeFilter,ConnectorTypeFilter:t.filter.ConnectorTypeFilter,VConnectorStatusFilter:t.filter.VConnectorStatusFilter,VChargeSpeed:t.filter.VChargeSpeed,PageNumber:t.paging.page,PageSize:t.paging.limit},callback:i=>{var o,r;if(t.response=i,null!=i&&i.Succeeded){if(t.pushData(null!==(o=i.Data)&&void 0!==o?o:[]),null!==(r=i.Data)&&void 0!==r&&r.length){let p=i.Data.filter(l=>l.LocLat&&l.LocLong).map(l=>(l.Distance2CL=parseFloat((0,y.GH)(t.currentPosition,{lat:null==l?void 0:l.LocLat,lng:null==l?void 0:l.LocLong}).toFixed(2)),l)).sort((l,F)=>{var C,M;return(null!==(C=l.Distance2CL)&&void 0!==C?C:0)-(null!==(M=F.Distance2CL)&&void 0!==M?M:0)});var g,m;p.length&&t.resetCamera({lat:null!==(g=p[0].LocLat)&&void 0!==g?g:0,lng:null!==(m=p[0].LocLong)&&void 0!==m?m:0})}}else(0,v.cX)(t.toastController,{},i).then(p=>p.present());t.paging.loading=!1,t.paging.active=!(null==i||!i.HasNextPage),n&&n()}}):(0,_.Bc)({params:{TopLeftLat:t.ChargingLocationParams.TopLeftLat,TopLeftLong:t.ChargingLocationParams.TopLeftLong,RightBottomLat:t.ChargingLocationParams.RightBottomLat,RightBottomLong:t.ChargingLocationParams.RightBottomLong,PageNumber:t.paging.page,PageSize:t.paging.limit},callback:i=>{var o;t.response=i,null!=i&&i.Succeeded?t.pushData(null!==(o=i.Data)&&void 0!==o?o:[]):(0,v.cX)(t.toastController,{},i).then(r=>r.present()),t.paging.loading=!1,t.paging.active=!(null==i||!i.HasNextPage),n&&n()}})})()}openDirection(n,t){return(0,u.A)(function*(){n.preventDefault(),yield I.P.open({url:(0,y.LZ)(yield(0,P.Xz)(),{lat:null==t?void 0:t.LocLat,lng:null==t?void 0:t.LocLong})})})()}openDetail(n,t){var i=this;return(0,u.A)(function*(){var o,r;i.router.navigateByUrl(D._.CHARGING_LOCATION_DETAIL.replace(":id",null!==(o=null===(r=t.ChargeLocationId)||void 0===r?void 0:r.toString())&&void 0!==o?o:""))})()}getFilters(){var n=[];if(this.filter.search&&n.push({type:"Search",value:this.filter.search,text:this.filter.search}),this.filter.ElectricTypeFilter)switch(this.filter.ElectricTypeFilter){case 1:n.push({type:"ElectricTypeFilter",value:this.filter.ElectricTypeFilter,text:"AC"});break;case 2:n.push({type:"ElectricTypeFilter",value:this.filter.ElectricTypeFilter,text:"DC"});break;case 3:n.push({type:"ElectricTypeFilter",value:this.filter.ElectricTypeFilter,text:"AllElectricType"})}if(this.filter.VConnectorStatusFilter)switch(this.filter.VConnectorStatusFilter){case 2500:n.push({type:"VConnectorStatusFilter",value:this.filter.VConnectorStatusFilter,text:"ConnectorReady"});break;case 2599:n.push({type:"VConnectorStatusFilter",value:this.filter.VConnectorStatusFilter,text:"AllConnectorStatus"})}return this.filter.ConnectorTypeFilter&&this.filter.ConnectorTypeFilter.split(";").forEach(t=>{n.push({type:"ConnectorTypeFilter",value:t,text:t})}),this.filter.VChargeSpeed&&T.My._data.filter(t=>t.LookupId==this.filter.VChargeSpeed).forEach(t=>{n.push({type:"VChargeSpeed",value:t.LookupId,text:t.Objectvalue})}),n}clearFilter(n,t){var i=this;return(0,u.A)(function*(){if("Search"==t.type)i.filter.search=void 0;else if("ElectricTypeFilter"==t.type)i.filter.ElectricTypeFilter=void 0;else if("VConnectorStatusFilter"==t.type)i.filter.VConnectorStatusFilter=void 0;else if("ConnectorTypeFilter"==t.type){var o;i.filter.ConnectorTypeFilter=null===(o=i.filter.ConnectorTypeFilter)||void 0===o?void 0:o.split(";").filter(r=>r!=t.value).join(";")}else"VChargeSpeed"==t.type&&(i.filter.VChargeSpeed=void 0);i.filterChange()})()}waitLoad(){var n=this;return(0,u.A)(function*(){if(n.timeoutLoadData=1e3,n.isWaitLoad)return;n.isWaitLoad=!0;let t=setInterval(()=>{if(n.timeoutLoadData>=0)n.timeoutLoadData-=100;else{if(clearTimeout(t),n.isWaitLoad=!1,Object.keys(n.filter).map(i=>n.filter[i]?1:0).find(i=>1==i))return;n.refreshData()}},100)})()}iframeLoaded(n){console.log(n),this._contentWindow=n.target.contentWindow,window.addEventListener("message",t=>{console.log("main",t.data.message,t.data.data),this._receiveMessages.filter(i=>i.message==t.data.message).forEach(i=>i.fn(t.data.data))}),this.receiveMessage("receive-clickMarker",t=>{this.clickMarker(t)}),this.receiveMessage("receive-boundchange",t=>{this.waitLoad()}),(0,P.Xz)().then(t=>{this.currentPosition=t,this.createMap(),this.createCurrentPosition(t)})}postMessage(n,t){this._contentWindow&&this._contentWindow.postMessage({message:n,data:t},"*")}receiveMessage(n,t){this._receiveMessages.push({message:n,fn:t})}createMap(){this.postMessage("createMap",{pos:this.currentPosition,zoom:f.c.app_default.geolocation.zoom})}createCurrentPosition(n){var t=this;return(0,u.A)(function*(){t.postMessage("createCurrentPosition",{pos:null!=n?n:t.currentPosition,icon:{url:f.c.app_default.icon.currentlocaltion,width:28,height:28}})})()}createMarkers(){this.postMessage("createMarkers",this.chargingLocations.map(n=>{var t,i;return{info:{id:n.ChargeLocationId,title:n.LocAddress},pos:{lat:null!==(t=n.LocLat)&&void 0!==t?t:f.c.app_default.geolocation.pos.lat,lng:null!==(i=n.LocLong)&&void 0!==i?i:f.c.app_default.geolocation.pos.lng},icon:{url:n.VLocationStatus==T.Ix.SanSang?f.c.app_default.icon.marker:f.c.app_default.icon.marker_off,width:30,height:40}}}))}resetCamera(n){n&&this.postMessage("resetCamera",{pos:n,zoom:16})}clickMarker(n){var t,i,o;this.resetCamera({lat:null!==(i=null==(t=this.chargingLocations.find(t=>t.ChargeLocationId==n.id))?void 0:t.LocLat)&&void 0!==i?i:f.c.app_default.geolocation.pos.lat,lng:null!==(o=null==t?void 0:t.LocLong)&&void 0!==o?o:f.c.app_default.geolocation.pos.lng}),this.presentModalMarket(void 0,n.id)}openDirectionByGoogleMap(n){return(0,u.A)(function*(){yield I.P.open({url:(0,y.LZ)(yield(0,P.Xz)(),n)})})()}refreshCurrentPosition(n,t){var i=this;A.L.getCurrentPosition({enableHighAccuracy:!0}).then(function(){var o=(0,u.A)(function*(r){if(r.coords){var g={lat:r.coords.latitude,lng:r.coords.longitude};yield(0,P.fj)({params:g}),i.createCurrentPosition(g),i.resetCamera(g),i.requestAddress(g)}t&&t()});return function(r){return o.apply(this,arguments)}}()).catch(()=>{t&&t()})}requestAddress(n){(0,R.S)({params:{lat:n.lat,lng:n.lng},callback:t=>{var i,o,r;"OK"==(null==t?void 0:t.status)&&(this.currentAddress=null!==(i=(null!==(o=t.results[0])&&void 0!==o?o:{}).formatted_address)&&void 0!==i?i:null===(r=t.plus_code)||void 0===r?void 0:r.compound_code,(0,P.RR)({params:{currentAddress:this.currentAddress}}))}})}presentModalMarket(n,t){var i=this;return(0,u.A)(function*(){const o=yield i.modalController.create({component:x.Z,componentProps:{ChargeLocationId:t},cssClass:"ion-modal-map-market"});o.onDidDismiss().then(r=>{var g,m,p,l;"Direction"!=r.role&&"GoogleMap"==r.role&&i.openDirectionByGoogleMap({lat:null!==(g=null===(m=r.data)||void 0===m?void 0:m.LocLat)&&void 0!==g?g:f.c.app_default.geolocation.pos.lat,lng:null!==(p=null===(l=r.data)||void 0===l?void 0:l.LocLong)&&void 0!==p?p:f.c.app_default.geolocation.pos.lng})}),o.present()})()}presentModalFilterChargingLocationComponent(n){var t=this;return(0,u.A)(function*(){const i=yield t.modalController.create({component:k.T,componentProps:{filter:Object.assign({},t.filter,{search:null})},backdropDismiss:!0,keyboardClose:!0,cssClass:"ion-modal-filter",enterAnimation:o=>(0,v.l9)(t.animationController,o),leaveAnimation:o=>(0,v.CV)(t.animationController,o)});i.onDidDismiss().then(o=>{"clear"==o.role?(t.filter={},t.filterChange()):"submit"==o.role&&(t.filter=o.data,t.filterChange())}),i.present()})()}presentModalVoice(n){var t=this;return(0,u.A)(function*(){const i=yield t.modalController.create({component:O.t,backdropDismiss:!0,keyboardClose:!0,cssClass:"ion-modal-breakpoint",initialBreakpoint:.75});i.onDidDismiss().then(o=>{"success"==o.role&&o.data&&(t.filter.search=o.data,t.filterChange())}),i.present()})()}presentModalSearchChargingLocationComponent(n){var t=this;return(0,u.A)(function*(){(0,v.Gn)(t.modalController,t.animationController)})()}presentModalNotify(n){var t=this;return(0,u.A)(function*(){(0,v.He)(t.modalController,t.animationController)})()}}return(a=d).\u0275fac=function(n){return new(n||a)(e.rXU(L.Ix),e.rXU(h.W3),e.rXU(h.Hx),e.rXU(h.K_),e.rXU(h.Xi))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-map-iframe-vietbando"]],decls:21,vars:3,consts:[["color","primary"],[1,"container-location","bg-primary"],[1,"d-flex","align-items-center"],[1,"col","px-0"],["color","light"],["src","../../../assets/icon/ion-icon/location.svg"],[3,"click"],["class","current-address",4,"ngIf"],["color","dark","src","../../../assets/icon/ion-icon/microphone.svg"],[1,"col-auto","pl-2","pr-0"],["src","../../../assets/icon/ion-icon/filter.svg"],[4,"ngIf"],["scroll-x","false","scroll-y","false",3,"fullscreen"],["src",e.wXG`https://app.isac.vn/assets/iframe/vietbando.html`,"frameborder","0","allowfullscreen","","webkitallowfullscreen","","allowtransparency","true","allow","autoplay; fullscreen",3,"load"],[1,"position-absolute","bottom-0","right-0"],["id","btn-geolocation","color","light",3,"click"],["src","../../../assets/icon/map/geolocation.svg"],[1,"current-address"],[1,"row","flex-nowrap","mt-3","list-filters","overflow-auto","text-nowrap"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["mode","ios","size","small","shape","round","color","light",3,"click"],["slot","end","name","close-outline"]],template:function(n,t){1&n&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"div",1)(3,"div",2)(4,"div",3)(5,"ion-chip",4)(6,"span"),e.nrm(7,"ion-icon",5),e.k0s(),e.j41(8,"ion-label",6),e.bIt("click",function(o){return t.presentModalSearchChargingLocationComponent(o)}),e.DNE(9,E,5,1,"div",7),e.k0s(),e.j41(10,"ion-button",6),e.bIt("click",function(o){return t.presentModalVoice(o)}),e.nrm(11,"ion-icon",8),e.k0s()()(),e.j41(12,"div",9)(13,"ion-button",6),e.bIt("click",function(o){return t.presentModalFilterChargingLocationComponent(o)}),e.nrm(14,"ion-icon",10),e.k0s()()()(),e.DNE(15,B,3,1,"ng-container",11),e.k0s()(),e.j41(16,"ion-content",12)(17,"iframe",13),e.bIt("load",function(o){return t.iframeLoaded(o)}),e.k0s(),e.j41(18,"div",14)(19,"ion-button",15),e.bIt("click",function(o){return t.refreshCurrentPosition(o)}),e.nrm(20,"ion-icon",16),e.k0s()()()),2&n&&(e.R7$(9),e.Y8G("ngIf",t.currentAddress),e.R7$(6),e.Y8G("ngIf",t.getFilters().length),e.R7$(),e.Y8G("fullscreen",!0))},dependencies:[b.Sq,b.bT,b.ux,b.e1,b.fG,h.Jm,h.ZB,h.W9,h.eU,h.iq,h.he,h.ai,G.D9],styles:["iframe[_ngcontent-%COMP%]{display:block;width:100%;height:100%;padding:0;margin:0;border:0;outline:none;background-color:#fff;position:fixed}#btn-geolocation[_ngcontent-%COMP%]{width:3rem;height:3rem;min-width:3rem;min-height:3rem;--padding-top: 0;--padding-start: 0;--padding-end: 0;--padding-bottom: 0;--border-radius: 50%;margin:0 1rem 7rem 0}#btn-geolocation[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:3rem;color:var(--ion-color-tertiary)}.container-location[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin:0;width:100%;min-height:2.5rem;border-radius:2.5rem;padding-inline-start:.5rem;padding-inline-end:.5rem;background:var(--ion-color-light);color:var(--ion-color-medium);padding-inline-end:.25rem}.container-location[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;margin-right:.25rem;font-size:1rem}.container-location[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{flex-grow:1}.container-location[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:2rem;min-height:2rem;margin-left:.5rem;--box-shadow: none;--border-width: 0}.container-location[_ngcontent-%COMP%]   .current-address[_ngcontent-%COMP%]{position:relative}.container-location[_ngcontent-%COMP%]   .current-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{transform:translateY(-50%);position:absolute;top:50%;left:0;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.container-location[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:2.5rem;min-height:2.5rem;--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;--border-radius: 50%;--border-width: 1px;--border-style: solid;--border-color: rgb(229, 229, 229, .8);--background: var(--ion-color-light);--color: var(--ion-color-primary)}.list-filters[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 1rem;--padding-end: 1rem;margin:0 .5rem 0 0}.list-filters[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:hover   ion-icon[slot=end][_ngcontent-%COMP%]{color:var(--ion-color-danger)}.list-filters[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:first-child{margin-left:1rem}"]}),d})()}];let W=(()=>{var a;class d{}return(a=d).\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[L.iI.forChild(z),L.iI]}),d})();var H=s(9500);let U=(()=>{var a;class d{}return(a=d).\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[b.MD,S.YN,h.bv,W,H.x]}),d})()}}]);